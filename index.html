<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>2026 æ²–ç¹©äº”å¤©å››å¤œ</title>
  <style>
    :root {
      --bg-color: #f7f5f0;
      --primary: #6b7a64; /* æŠ¹èŒ¶ç¶  */
      --secondary: #c4b095; /* æœ¨è³ªèª¿ */
      --text-dark: #3a3a3a;
      --text-light: #7a7a7a;
      --white: #ffffff;
      --nav-btn: #e56b55; /* çŠç‘šç´… */
      --expense-bg: #eaf1e8;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, 'PingFang TC', 'Heiti TC', 'Microsoft JhengHei', sans-serif; }
    body { background-color: var(--bg-color); color: var(--text-dark); padding-bottom: 70px; }
    
    /* Header */
    header { background-color: var(--primary); color: var(--white); padding: 20px 15px 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h1 { font-size: 1.2rem; font-weight: 600; margin-bottom: 5px; }
    h2 { font-size: 0.9rem; font-weight: 400; opacity: 0.9; }
    
    /* Day Selector */
    .day-selector { display: flex; overflow-x: auto; padding: 15px; gap: 10px; scrollbar-width: none; }
    .day-selector::-webkit-scrollbar { display: none; }
    .day-btn { background: var(--white); border: 1px solid #ddd; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: var(--text-dark); white-space: nowrap; transition: 0.2s; }
    .day-btn.active { background: var(--primary); color: var(--white); border-color: var(--primary); }

    /* Content Area */
    .main-tab { display: none; }
    .main-tab.active { display: block; }
    .content-section { display: none; padding: 0 15px 20px; }
    .content-section.active { display: block; }
    
    /* Cards */
    .card { background: var(--white); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); border-left: 5px solid var(--secondary); position: relative; }
    .card.transit { border-left-color: #5b8fb9; }
    .card.food { border-left-color: #e5a955; }
    .card.stay { border-left-color: #9b59b6; }
    .card.routine { border-left-color: #95a5a6; padding: 10px 15px; } 
    
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
    .card.routine .card-header { margin-bottom: 0; border-bottom: none; padding-bottom: 0; }
    
    .time { font-weight: bold; font-size: 1.1rem; color: var(--primary); }
    .weather { font-size: 0.85rem; color: var(--text-light); display: flex; align-items: center; gap: 5px; }
    
    .card-title { font-size: 1.15rem; font-weight: bold; margin-bottom: 8px; }
    .card.routine .card-title { font-size: 1rem; margin-bottom: 0; display: inline-block; margin-left: 10px; }
    .card-address { font-size: 0.85rem; color: var(--text-light); margin-bottom: 12px; line-height: 1.4; }
    
    .phone-nav { background: #f0f4f0; padding: 8px; border-radius: 6px; font-size: 1.1rem; font-weight: bold; color: var(--primary); margin-bottom: 12px; display: inline-block; letter-spacing: 1px; border: 1px solid #dce5dc; }
    .phone-nav::before { content: 'â˜ è»Šæ©Ÿ: '; font-size: 0.85rem; font-weight: normal; color: var(--text-light); }

    .guide-box { background: #fffcf5; border: 1px solid #ffebc2; padding: 10px; border-radius: 6px; font-size: 0.9rem; line-height: 1.5; margin-bottom: 12px; }
    .tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; margin-right: 5px; color: #fff; }
    .tag.eat { background: #e67e22; }
    .tag.buy { background: #e74c3c; }
    .tag.alert { background: #c0392b; }
    .nav-btn { display: block; width: 100%; text-align: center; background: var(--nav-btn); color: white; text-decoration: none; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 1rem; }
    
    /* Tools Section */
    .tool-card { background: var(--white); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); }
    .tool-card h3 { border-bottom: 2px solid var(--secondary); padding-bottom: 8px; margin-bottom: 10px; color: var(--primary); }
    .tool-list li { list-style: none; margin-bottom: 8px; font-size: 0.9rem; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }

    /* Accounting Section */
    .acct-header { display: flex; justify-content: space-between; align-items: center; background: var(--expense-bg); padding: 15px; border-radius: 12px; margin-bottom: 15px; }
    .rate-box { font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
    .rate-input { width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-weight: bold; }
    
    .total-display { text-align: right; }
    .total-jpy { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
    .total-twd { font-size: 0.9rem; color: var(--text-light); }

    /* Pie Chart Area */
    .chart-container { display: flex; align-items: center; gap: 20px; background: var(--white); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); }
    .pie-chart { width: 100px; height: 100px; border-radius: 50%; background: #e9ecef; flex-shrink: 0; transition: background 0.5s ease; }
    .legend { flex: 1; font-size: 0.85rem; }
    .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .color-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }

    /* Accounting Inputs */
    .input-group { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
    .input-item { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; flex: 1; }
    .btn-add { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; flex-basis: 100%; font-size: 1.05rem; }
    
    /* Expense List */
    .expense-list { list-style: none; }
    .expense-item { display: flex; justify-content: space-between; align-items: center; background: var(--white); padding: 12px 15px; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .expense-info { display: flex; flex-direction: column; gap: 3px; }
    .expense-name { font-weight: bold; font-size: 1rem; display: flex; align-items: center; }
    .day-badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; color: white; margin-right: 8px; font-weight: normal; }
    .expense-twd { font-size: 0.8rem; color: var(--text-light); }
    .expense-jpy { font-weight: bold; color: var(--nav-btn); font-size: 1.1rem; }
    .btn-delete { background: #ffecec; color: #e74c3c; border: none; padding: 6px 10px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; margin-left: 10px; font-weight: bold;}

    /* Bottom Nav Bar */
    .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--white); display: flex; justify-content: space-around; padding: 10px 0 calc(10px + env(safe-area-inset-bottom)); box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; }
    .bottom-nav-item { text-align: center; font-size: 0.8rem; color: var(--text-light); text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; flex: 1; }
    .bottom-nav-item.active { color: var(--primary); font-weight: bold; }
    .bottom-nav-item svg { width: 22px; height: 22px; fill: currentColor; }
  </style>
</head>
<body>

  <header>
    <h1>2026 æ²–ç¹©äº”å¤©å››å¤œ</h1>
    <h2>3/11~3/15 æ²–ç¹©è‡ªé§• ğŸš—</h2>
  </header>

  <div id="tab-itinerary" class="main-tab active">
    <div class="day-selector" id="day-selector"></div>
    <div id="itinerary-content"></div>
  </div>

  <div id="tab-tools" class="main-tab" style="padding: 15px;">
    <div class="tool-card">
      <h3>âœˆï¸ èˆªç­è³‡è¨Š</h3>
      <ul class="tool-list">
        <li><strong>å»ç¨‹ (3/11)</strong>: FD230 | 13:30 èµ·é£› - 15:15 é™è½</li>
        <li><strong>å›ç¨‹ (3/15)</strong>: C123 | 20:20 èµ·é£›</li>
      </ul>
    </div>
    <div class="tool-card">
      <h3>ğŸ  ä½å®¿è³‡è¨Š</h3>
      <ul class="tool-list">
        <li><strong>åç¨±</strong>: CONDOMINIUM IT-BIN</li>
        <li><strong>åœ°å€</strong>: 7 Chome-9-33 Hiyagon, Okinawa, 904-2173</li>
        <li><strong>é›»è©±</strong>: å»ºè­°è‡ªå‚™è¨‚æˆ¿ç¶²è¯çµ¡æ–¹å¼</li>
      </ul>
    </div>
    <div class="tool-card">
      <h3>ğŸ†˜ ç·Šæ€¥è¯çµ¡é›»è©±</h3>
      <ul class="tool-list">
        <li><strong>å ±è­¦</strong>: 110</li>
        <li><strong>æ•‘è­·è»Š/ç«è­¦</strong>: 119</li>
        <li><strong>å°åŒ—é§æ—¥ç¶“æ¿Ÿæ–‡åŒ–ä»£è¡¨è™• (é‚£éœ¸)</strong>: +81-98-862-7008</li>
      </ul>
    </div>
  </div>

  <div id="tab-accounting" class="main-tab" style="padding: 15px;">
    
    <div class="acct-header">
      <div class="rate-box">
        åŒ¯ç‡: <input type="number" id="fx-rate" class="rate-input" value="0.21" step="0.001" onchange="updateTotals()">
      </div>
      <div class="total-display">
        <div class="total-jpy">Â¥ <span id="sum-jpy">0</span></div>
        <div class="total-twd">ç´„ NT$ <span id="sum-twd">0</span></div>
      </div>
    </div>

    <div class="chart-container">
      <div class="pie-chart" id="pie-chart"></div>
      <div class="legend" id="legend">
        </div>
    </div>

    <div class="input-group">
      <select id="exp-day" class="input-item" style="flex: 1; min-width: 100px;">
        <option value="1">Day 1 (3/11)</option>
        <option value="2">Day 2 (3/12)</option>
        <option value="3">Day 3 (3/13)</option>
        <option value="4">Day 4 (3/14)</option>
        <option value="5">Day 5 (3/15)</option>
      </select>
      <input type="text" id="exp-name" class="input-item" style="flex: 2; min-width: 120px;" placeholder="é …ç›®åç¨± (ä¾‹: æ‹‰éºµ)">
      <input type="number" id="exp-price" class="input-item" style="flex: 1; min-width: 100px;" placeholder="Â¥ é‡‘é¡">
      <button class="btn-add" onclick="addExpense()">ï¼‹ æ–°å¢é€™ç­†èŠ±è²»</button>
    </div>

    <ul class="expense-list" id="expense-list">
      </ul>
  </div>

  <div class="bottom-nav">
    <div class="bottom-nav-item active" onclick="switchTab('itinerary', this)">
      <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>
      æ¯æ—¥è¡Œç¨‹
    </div>
    <div class="bottom-nav-item" onclick="switchTab('tools', this)">
      <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
      å¯¦ç”¨å·¥å…·
    </div>
    <div class="bottom-nav-item" onclick="switchTab('accounting', this)">
      <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
      é ç®—è¨˜å¸³
    </div>
  </div>

  <script>
    // ================= è¡Œç¨‹è³‡æ–™å€ =================
    const itineraryData = [
      {
        id: "day1", label: "3/11(ä¸‰)", 
        events: [
          { time: "15:55", title: "é‚£éœ¸æ©Ÿå ´ é™è½", type: "transit", address: "Okinawa, Naha, Kagamizu, 150", phone: "098-840-1151", weather: "â›… 22Â°C" },
          { time: "17:30", title: "ORIX Rent-a-car é‚£éœ¸æ©Ÿå ´åº—", type: "transit", address: "1-1174 Toyosaki, Tomigusuku. Okinawa 901-0225", phone: "098-851-0543", weather: "â›… 22Â°C" },
          { time: "18:30", title: "æ°‘å®¿ Check in (CONDOMINIUM IT-BIN)", type: "stay", address: "7 Chome-9-33 Hiyagon, Okinawa 904-2173", weather: "ğŸŒ™ 20Â°C" },
          { time: "19:00", title: "åŒ—è°·ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ã¡ã‚ƒãã¶ã€œ (æ™šé¤)", type: "food", address: "614-1 Kuwae Chatan Nakagami, District Okinawa", phone: "098-923-2229", weather: "ğŸŒ™ 19Â°C", guide: "<span class='tag eat'>å¿…åƒç¾é£Ÿ</span> é˜¿å¤è±¬ç«é‹ï¼" },
          // é€™è£¡ä¾ç…§æ‚¨çš„éœ€æ±‚ï¼Œå°‡æ™šä¸Š21:00çš„è¡Œç¨‹æ‹†æˆå…©å¼µç¨ç«‹å¡ç‰‡
          { time: "21:00", title: "AEON MALL Okinawa Rycom", type: "buy", address: "1ç•ªåœ° Raikamu, Kitanakagusuku, Nakagami District", phone: "098-930-0425", weather: "ğŸŒ™ 19Â°C", guide: "<span class='tag buy'>é€›è¡—æ¡è²·</span> æ²–ç¹©æœ€å¤§å‹è³¼ç‰©ä¸­å¿ƒä¹‹ä¸€ã€‚" },
          { time: "21:00", title: "MEGA å”å‰è¨¶å¾· å®‡æµéº»åº—", type: "buy", address: "æ—¥æœ¬ã€’904-2231 Okinawa, Uruma, Shioya, 502-1", phone: "098-983-6611", weather: "ğŸŒ™ 19Â°C", guide: "<span class='tag buy'>é€›è¡—æ¡è²·</span> å°è²·ä¸€äº›æ±è¥¿å›æ°‘å®¿ï¼Œå¯ç‡Ÿæ¥­åˆ°æ·±å¤œã€‚" }
        ]
      },
      {
        id: "day2", label: "3/12(å››)", 
        events: [
          { time: "09:00", title: "èµ·åºŠ", type: "routine" },
          { time: "10:00", title: "å‡ºé–€", type: "routine" },
          { time: "11:00", title: "æ³¢ä¸Šå®®", type: "spot", address: "1 Chome-25-11 Wakasa, Naha, Okinawa", phone: "098-868-3697", weather: "â˜€ï¸ 24Â°C" },
          { time: "13:00", title: "åœ‹éš›é€š & ç‰§å¿—å¸‚å ´", type: "spot", address: "3 Chome-2-10 Makishi, Naha", phone: "098-867-6560", weather: "â˜€ï¸ 25Â°C", guide: "<span class='tag buy'>ä¼´æ‰‹ç¦®</span>" },
          { time: "19:00", title: "ç‰å®¶æ‹‰éºµ æˆ– é˜¿å¤è±¬è±¬æ’", type: "food", address: "1 Chome-6-8 Matsuo, Naha", phone: "098-862-3480", weather: "ğŸŒ™ 21Â°C", guide: "æ™šé¤é¸é … 1 æˆ– 2" },
          { time: "21:00", title: "AEON", type: "buy", address: "1ç•ªåœ° Raikamu, Kitanakagusuku", phone: "", weather: "ğŸŒ™ 21Â°C" }
        ]
      },
      {
        id: "day3", label: "3/13(äº”)", 
        events: [
          { time: "07:30", title: "èµ·åºŠ", type: "routine" },
          { time: "08:30", title: "å‡ºé–€", type: "routine" },
          { time: "09:30å‰", title: "æŠµé” å¤å®‡åˆ©å³¶", type: "spot", address: "Kouri, Nakijin, Kunigami", phone: "098-056-1616", weather: "â˜€ï¸ 26Â°C" },
          { time: "ä¸­åˆéå¾Œ", title: "ç¾éº—æµ·æ°´æ—é¤¨", type: "spot", address: "424 Ishikawa, Motobu", phone: "0980-48-3748", weather: "â˜€ï¸ 25Â°C" },
          { time: "å›ç¨‹", title: "å›å®¶è·¯ä¸Šè¶…å•† & è¨±ç”°ä¼‘æ¯ç«™", type: "spot", address: "17 Kyoda, Nago, Okinawa", phone: "0980-54-0880", weather: "â›… 23Â°C" },
          { time: "æ™šä¸Š", title: "å±…é…’å±‹", type: "food", address: "æ°‘å®¿é™„è¿‘", weather: "ğŸŒ™ 22Â°C" }
        ]
      },
      {
        id: "day4", label: "3/14(å…­)", 
        events: [
          { time: "08:30", title: "èµ·åºŠ", type: "routine" },
          { time: "09:30", title: "å‡ºé–€", type: "routine" },
          { time: "10:00", title: "æŠµé” Parco City / æ¸¯å·å¤–äººä½å®…", type: "buy", address: "3 Chome-1-1 Irijima, Urasoe", phone: "098-871-1120", weather: "â˜€ï¸ 24Â°C", guide: "é€›è¡— Day" },
          { time: "14:00", title: "ç¾åœ‹æ‘", type: "spot", address: "Mihama, Chatan, Nakagami District", phone: "098-926-5678", weather: "ğŸŒ… 22Â°C" },
          { time: "19:00", title: "ç‡’è‚‰é‡‘æˆ (Yakiniku King)", type: "food", address: "1 Chome-11-10 Kitamae, Chatan", phone: "098-989-0298", weather: "ğŸŒ™ 20Â°C" }
        ]
      },
      {
        id: "day5", label: "3/15(æ—¥)", 
        events: [
          { time: "çœ‹é€›å¤šä¹…", title: "ç‰æ³‰æ´ / ricoland Okinawa / A&Wæ¼¢å ¡ / ç€¨é•·å³¶", type: "spot", address: "å—éƒ¨æ™¯é»å½ˆæ€§å®‰æ’", weather: "â›… 23Â°C" },
          { time: "17:30å‰", title: "ORIX é‚£éœ¸æ©Ÿå ´ é è¨ˆé‚„è»Š", type: "transit", address: "1-1174 Toyosaki, Tomigusuku", phone: "098-851-0543", weather: "ğŸŒ… 22Â°C" },
          { time: "20:20", title: "èµ·é£› (å›ç¨‹)", type: "transit", address: "é‚£éœ¸æ©Ÿå ´", weather: "ğŸŒ™ 21Â°C" }
        ]
      }
    ];

    function renderDays() {
      const selector = document.getElementById('day-selector');
      const container = document.getElementById('itinerary-content');
      
      itineraryData.forEach((day, index) => {
        const btn = document.createElement('button');
        btn.className = `day-btn ${index === 0 ? 'active' : ''}`;
        btn.innerText = day.label;
        btn.onclick = () => selectDay(index);
        selector.appendChild(btn);

        const section = document.createElement('div');
        section.className = `content-section ${index === 0 ? 'active' : ''}`;
        section.id = `content-${index}`;
        
        day.events.forEach(event => {
          if(event.type === 'routine') {
             section.innerHTML += `
              <div class="card routine">
                <div class="card-header">
                  <span class="time">${event.time}</span>
                  <span class="card-title">${event.title}</span>
                </div>
              </div>
            `;
            return;
          }

          const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.address || event.title)}`;
          const phoneHtml = event.phone ? `<div class="phone-nav">${event.phone}</div>` : '';
          const guideHtml = event.guide ? `<div class="guide-box">${event.guide}</div>` : '';
          
          section.innerHTML += `
            <div class="card ${event.type}">
              <div class="card-header">
                <div class="time">${event.time}</div>
                <div class="weather">${event.weather}</div>
              </div>
              <div class="card-title">${event.title}</div>
              ${phoneHtml}
              <div class="card-address">ğŸ“ ${event.address}</div>
              ${guideHtml}
              <a href="${mapLink}" target="_blank" class="nav-btn">ğŸš— å°èˆªè‡³æ­¤</a>
            </div>
          `;
        });
        container.appendChild(section);
      });
    }

    function selectDay(index) {
      document.querySelectorAll('.day-btn').forEach((btn, i) => btn.classList.toggle('active', i === index));
      document.querySelectorAll('.content-section').forEach((sec, i) => sec.classList.toggle('active', i === index));
    }

    function switchTab(tabId, element) {
      document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
      element.classList.add('active');
      document.querySelectorAll('.main-tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    // ================= è¨˜å¸³åŠŸèƒ½èˆ‡åœ“é¤…åœ– =================
    let expenses = JSON.parse(localStorage.getItem('okinawa_expenses')) || [];
    const dayColors = { "1": "#e56b55", "2": "#f1c40f", "3": "#3498db", "4": "#9b59b6", "5": "#2ecc71" };
    const dayLabels = { "1": "3/11", "2": "3/12", "3": "3/13", "4": "3/14", "5": "3/15" };

    window.onload = () => {
      renderDays();
      const savedRate = localStorage.getItem('okinawa_rate');
      if (savedRate) document.getElementById('fx-rate').value = savedRate;
      renderExpenses();
    };

    function addExpense() {
      const dayInput = document.getElementById('exp-day').value;
      const nameInput = document.getElementById('exp-name');
      const priceInput = document.getElementById('exp-price');
      const name = nameInput.value.trim();
      const price = parseFloat(priceInput.value);

      if (!name || isNaN(price) || price <= 0) {
        alert("è«‹è¼¸å…¥æ­£ç¢ºçš„é …ç›®åç¨±èˆ‡æ—¥å¹£é‡‘é¡å“¦ï¼");
        return;
      }

      expenses.push({ id: Date.now(), day: dayInput, name, jpy: price });
      saveData();
      
      nameInput.value = '';
      priceInput.value = '';
      renderExpenses();
    }

    function deleteExpense(id) {
      expenses = expenses.filter(exp => exp.id !== id);
      saveData();
      renderExpenses();
    }

    function saveData() {
      localStorage.setItem('okinawa_expenses', JSON.stringify(expenses));
      localStorage.setItem('okinawa_rate', document.getElementById('fx-rate').value);
    }

    function renderExpenses() {
      const list = document.getElementById('expense-list');
      const rate = parseFloat(document.getElementById('fx-rate').value) || 0.21;
      list.innerHTML = '';
      
      let sumJpy = 0;
      let dayTotals = { "1": 0, "2": 0, "3": 0, "4": 0, "5": 0 };

      // æŒ‰ç…§å¤©æ•¸æ’åº
      const sortedExpenses = [...expenses].sort((a, b) => parseInt(a.day) - parseInt(b.day));

      sortedExpenses.forEach(exp => {
        sumJpy += exp.jpy;
        dayTotals[exp.day] += exp.jpy;
        
        const twd = Math.round(exp.jpy * rate);
        list.innerHTML += `
          <li class="expense-item">
            <div class="expense-info">
              <span class="expense-name">
                <span class="day-badge" style="background:${dayColors[exp.day]}">Day ${exp.day}</span>
                ${exp.name}
              </span>
              <span class="expense-twd">ç´„ NT$ ${twd.toLocaleString()}</span>
            </div>
            <div style="display: flex; align-items: center;">
              <span class="expense-jpy">Â¥ ${exp.jpy.toLocaleString()}</span>
              <button class="btn-delete" onclick="deleteExpense(${exp.id})">âœ•</button>
            </div>
          </li>
        `;
      });

      document.getElementById('sum-jpy').innerText = sumJpy.toLocaleString();
      document.getElementById('sum-twd').innerText = Math.round(sumJpy * rate).toLocaleString();
      
      renderChart(dayTotals, sumJpy);
      saveData(); 
    }

    // ç¹ªè£½ CSS åœ“é¤…åœ–
    function renderChart(dayTotals, total) {
      const chart = document.getElementById('pie-chart');
      const legend = document.getElementById('legend');
      
      if (total === 0) {
        chart.style.background = '#e9ecef';
        legend.innerHTML = '<p style="color:#999; text-align:center; padding-top:20px;">æ–°å¢é …ç›®ä¾†ç”¢ç”Ÿåœ–è¡¨</p>';
        return;
      }

      let gradientString = [];
      let startPercent = 0;
      let legendHtml = '';

      for (let i = 1; i <= 5; i++) {
        let dayTotal = dayTotals[i.toString()];
        if (dayTotal > 0) {
          let percentage = (dayTotal / total) * 100;
          let endPercent = startPercent + percentage;
          
          gradientString.push(`${dayColors[i]} ${startPercent}% ${endPercent}%`);
          startPercent = endPercent;
          
          legendHtml += `
            <div class="legend-item">
              <span class="color-dot" style="background:${dayColors[i]}"></span>
              Day ${i}ï¼šÂ¥ ${dayTotal.toLocaleString()}
            </div>
          `;
        }
      }
      
      chart.style.background = `conic-gradient(${gradientString.join(', ')})`;
      legend.innerHTML = legendHtml;
    }

    function updateTotals() {
      renderExpenses();
    }
  </script>
</body>
</html>
